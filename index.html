<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>J+D Partner Map</title>

    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />

    <!-- Leaflet MarkerCluster CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />

    <!-- Main Application Styles -->
    <link rel="stylesheet" href="css/main.css" />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="logo-container">
        <div class="title-section">
          <div class="title">J+D Partner Network Map</div>
        </div>
        
        <!-- Add Partner Button moved back to header -->
        <button id="add-partner-btn" class="add-partner-btn" title="Toggle Add Partner Mode">
          Add Partner
        </button>
      </div>
      <div class="controls">
        <!-- User info (shown when authenticated) -->
        <div id="user-info" class="user-info" style="display: none">
          <span id="user-email">user@example.com</span>
          <button id="logout-btn" class="btn-logout">Logout</button>
        </div>
      </div>
    </header>

    <!-- Map Container -->
    <div id="map"></div>

    <!-- Authentication Overlay -->
    <div id="auth-overlay" class="auth-overlay">
      <div class="auth-message">
        <h2>Authentication Required</h2>
        <p>Please authenticate with Airtable to access the J+D Partner Network Map.</p>
        <p><strong>You must have access to the "J+D Lab Network" base in Airtable.</strong></p>
        <button id="airtable-login-btn" class="btn-auth">Authenticate with Airtable</button>
        <div id="auth-error" class="auth-error"></div>
      </div>
    </div>

    <!-- Mode Indicator -->
    <div id="mode-indicator" class="mode-indicator">
      <span>Click on the map to add a partner</span>
    </div>

    <!-- Partner Form Modal -->
    <div id="partner-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Add New Partner</h2>
          <button class="modal-close">&times;</button>
        </div>
        <form id="partner-form" class="partner-form">
          <div class="form-row">
            <div class="form-group">
              <label for="partner-name">Organization Name *</label>
              <input type="text" id="partner-name" name="partner-name" required />
            </div>
            <div class="form-group">
              <label for="partner-type">Partner Type *</label>
              <select id="partner-type" name="partner-type" required>
                <option value="">Select Type...</option>
                <option value="Connector">Connector</option>
                <option value="Information Hub">Information Hub</option>
                <option value="Funder">Funder</option>
                <option value="News Organization">News Organization</option>
                <option value="Community College">Community College</option>
                <option value="Library">Library</option>
                <option value="Other">Other</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group full-width">
              <label for="partner-address">Address</label>
              <input type="text" id="partner-address" name="partner-address" placeholder="Street address, City, State, ZIP" />
              <button type="button" id="geocode-address" class="geocode-btn">Geocode Address</button>
              <div class="geocoding-status"></div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="partner-latitude">Latitude *</label>
              <input type="number" id="partner-latitude" name="partner-latitude" step="any" readonly required />
            </div>
            <div class="form-group">
              <label for="partner-longitude">Longitude *</label>
              <input type="number" id="partner-longitude" name="partner-longitude" step="any" readonly required />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group full-width">
              <label for="partner-description">Description</label>
              <textarea id="partner-description" name="partner-description" rows="3" placeholder="Brief description of the organization..."></textarea>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="partner-contact">Contact Person</label>
              <input type="text" id="partner-contact" name="partner-contact" placeholder="Contact name" />
            </div>
            <div class="form-group">
              <label for="partner-email">Contact Email</label>
              <input type="email" id="partner-email" name="partner-email" placeholder="contact@organization.org" />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="partner-phone">Contact Phone</label>
              <input type="tel" id="partner-phone" name="partner-phone" placeholder="(555) 123-4567" />
            </div>
            <div class="form-group">
              <label for="partner-project-link">Project Tracking Link</label>
              <input type="url" id="partner-project-link" name="partner-project-link" placeholder="https://..." />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group full-width">
              <label for="partner-notes">Notes</label>
              <textarea id="partner-notes" name="partner-notes" rows="2" placeholder="Additional notes..."></textarea>
            </div>
          </div>

          <div id="save-progress" class="save-progress hidden">Saving...</div>

          <div class="form-actions">
            <button type="submit" id="save-partner-btn" class="save-btn">Save Partner</button>
            <button type="button" id="cancel-partner" class="cancel-btn">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>

    <!-- Leaflet MarkerCluster Plugin -->
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

    <!-- Partner Management System -->
    <script src="js/partners.js"></script>

    <!-- Core Application JavaScript -->
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/airtable.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
  </body>
</html>